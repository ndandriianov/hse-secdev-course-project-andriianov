# BDD-сценарии для ключевых NFR

## 1. Время отклика API (NFR-1)

```gherkin
Feature: время отклика API
  As пользователь системы
  I want получать быстрые ответы от API
  So that я могу эффективно работать с приложением

Scenario: API отвечает в пределах 200 мс для основных эндпоинтов
  Given система OKR Tracker запущена и работает
  And пользователь аутентифицирован в системе
  
  When пользователь отправляет GET запрос к /objectives
  Then система должна ответить в течение 200 мс
  And время отклика должно быть зафиксировано в метриках
  
  When пользователь отправляет GET запрос к /key-results
  Then система должна ответить в течение 200 мс
  
  When пользователь отправляет GET запрос к /auth/me
  Then система должна ответить в течение 200 мс
  
  When пользователь отправляет GET запрос к /stats
  Then система должна ответить в течение 200 мс

Scenario: время отклика для операций записи
  Given система OKR Tracker запущена и работает
  And пользователь аутентифицирован в системе
  
  When пользователь создает новую цель через POST /objectives
  Then система должна ответить в течение 200 мс
  
  When пользователь обновляет цель через PUT /objectives/1
  Then система должна ответить в течение 200 мс
  
  When пользователь создает ключевой результат через POST /key-results
  Then система должна ответить в течение 200 мс
```

## 2. Защита от атак (NFR-4)

```gherkin
Feature: защита от брутфорс атак
  As система безопасности
  I want блокировать злоумышленников
  So that защитить пользовательские аккаунты от взлома

Scenario: блокировка пользователя после 5 неуспешных попыток входа
  Given система OKR Tracker запущена и работает
  And в системе существует пользователь с email "user@example.com"
  And пользователь НЕ заблокирован
  
  When злоумышленник пытается войти с неверным паролем 1 раз
  Then система должна вернуть ошибку "неверные учетные данные"
  And пользователь НЕ должен быть заблокирован
  
  When злоумышленник пытается войти с неверным паролем 2 раз
  Then система должна вернуть ошибку "неверные учетные данные"
  And пользователь НЕ должен быть заблокирован
  
  When злоумышленник пытается войти с неверным паролем 3 раз
  Then система должна вернуть ошибку "неверные учетные данные"
  And пользователь НЕ должен быть заблокирован
  
  When злоумышленник пытается войти с неверным паролем 4 раз
  Then система должна вернуть ошибку "неверные учетные данные"
  And пользователь НЕ должен быть заблокирован
  
  When злоумышленник пытается войти с неверным паролем 5 раз
  Then система должна заблокировать пользователя на 5 минут
  And система должна вернуть ошибку "аккаунт временно заблокирован"
  And событие блокировки должно быть залогировано в аудите

Scenario: разблокировка пользователя через 5 минут
  Given система OKR Tracker запущена и работает
  And пользователь "user@example.com" заблокирован после 5 неуспешных попыток
  And с момента блокировки прошло 5 минут
  
  When пользователь пытается войти с правильным паролем
  Then система должна разрешить вход
  And пользователь должен быть успешно аутентифицирован
  And счетчик неуспешных попыток должен быть сброшен
```

## 3. Аудит критичных операций (NFR-6)

```gherkin
Feature: аудит критичных операций
  As администратор системы
  I want отслеживать все критичные действия пользователей
  So that обеспечить безопасность и соответствие требованиям

Scenario: логирование критичных операций в течение 15 секунд
  Given система OKR Tracker запущена и работает
  And пользователь аутентифицирован в системе
  And система аудита активна и настроена
  
  When пользователь успешно входит в систему
  Then событие "LOGIN_SUCCESS" должно быть залогировано в течение 15 секунд
  And лог должен содержать: timestamp, user_id, ip_address, action_type
  
  When пользователь создает новую цель "Изучить Python"
  Then событие "OBJECTIVE_CREATED" должно быть залогировано в течение 15 секунд
  And лог должен содержать: timestamp, user_id, objective_id, action_type, changes
  
  When пользователь обновляет ключевой результат с прогрессом 50%
  Then событие "KEY_RESULT_UPDATED" должно быть залогировано в течение 15 секунд
  And лог должен содержать: timestamp, user_id, key_result_id, action_type, old_value, new_value
  
  When пользователь удаляет цель "Старая цель"
  Then событие "OBJECTIVE_DELETED" должно быть залогировано в течение 15 секунд
  And лог должен содержать: timestamp, user_id, objective_id, action_type, deleted_data
  
  When пользователь меняет пароль
  Then событие "PASSWORD_CHANGED" должно быть залогировано в течение 15 секунд
  And лог должен содержать: timestamp, user_id, action_type, security_level

Scenario: покрытие аудитом критичных операций
  Given система OKR Tracker запущена и работает
  And пользователь аутентифицирован в системе
  And система аудита активна
  
  When пользователь выполняет операции: вход, создание цели, обновление KR, удаление цели, смена пароля
  Then каждая операция должна быть залогирована в течение 15 секунд
  And общее покрытие аудитом должно составлять не менее 80%
  And все логи должны содержать корректные данные пользователя и времени
```
