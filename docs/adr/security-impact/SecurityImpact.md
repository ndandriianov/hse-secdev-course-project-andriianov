## 1. Влияние ADR-001: Формат ошибок по стандарту RFC 7807

Положительное влияние
- Уменьшение риска раскрытия внутренней информации (R7): унифицированные ответы исключают стектрейсы и внутренние детали из ответов клиенту.
- Улучшение трассируемости инцидентов через correlation_id: упрощает сопоставление клиентского инцидента с серверными логами и отладку.
- Упрощение автоматического мониторинга и алертинга (одинаковая структура ошибок).

Оставшиеся/новые риски
- Возможность логирования correlation_id вместе со чувствительными данными — риск раскрытия при неправильной настройки логов.
- Если middleware ошибочно фильтрует детали (например, заменяет полезную информацию безопасности), это может усложнить расследование.
- Несогласованность типов `type`/`title` между сервисами → ложные срабатывания мониторинга или неправильная обработка на клиентах.

Рекомендации по смягчению
- Логи: хранить полные детали (стектрейсы) ТОЛЬКО в защищённых хранилищах логов с доступом по принципу наименьших привилегий; в логах экспортируемых в менее защищённые системы — маскировать чувствительные поля.
- Политика использования correlation_id: четко документировать и включить его в требования к аудиту (NFR-6).
- Тесты: автоматические тесты, которые проверяют, что ни один 4xx/5xx ответ не содержит стектрейс или сырые внутренние поля.
- Контракт: в OpenAPI/README перечислить допустимые `type`/`title` для основных ошибок; использовать интеграционные тесты для проверки соответствия.

---

## 2. Влияние ADR-002: Нормализация дат и денег — UTC, Decimal, локаль

Положительное влияние
- Снижение логических ошибок и утечек, связанных с неверной интерпретацией времён (R2) — уменьшает вероятность ошибочного доступа к чужим данным из-за несоответствия времённых рамок.
- Устраняет потери точности в финансовых/метрических расчётах (исключая float для денег) → уменьшение инцидентов, связанных с некорректными вычислениями.
- Облегчает тестирование и воспроизводимость инцидентов (канонические форматы).

Оставшиеся/новые риски
- Неправильная сериализация/десериализация (например, Decimal → float) может привести к silent data corruption.
- При ошибках в миграциях/контрактах API возможны regressions (клиенты получают неожиданные форматы) — это может привести к утечке (например, приложения начнут логировать raw-значения).
- Отбрасывание дат без tzinfo может привести к отказам в обслуживании (различные клиенты будут получать ошибки) — риск операционной доступности.

Рекомендации по смягчению
- Контракты: зафиксировать формат в OpenAPI и обеспечить проверку контрактных тестов в CI (NFR-8).
- Сериализация: централизованный encoder/decoder для Decimal и timezone-aware datetime; в тестах проверять round-trip.
- Миграции БД: включать проверки в CI и иметь откаты (backups) перед изменениями схем для полей money/timestamp.
- Документация для клиентов: чётко описать обязательный формат входящих дат и money (например, amount как строка).
- Monitoring: метрики ошибок парсинга/валидации должны попадать в алерты (чтобы выявлять разрыв в контрактах быстро).

---

## 3. ADR-003: Управление секретами — источники, ротация, защита

Положительное влияние
- Снижение вероятности утечек секретов через репозиторий и логи (R6, R7) за счёт запрета хардкодинга и включения сканеров (gitleaks/semgrep).
- Маскирование секретов в логах предотвращает их случайное раскрытие в индексируемых логах.
- Политика ротации и принцип наименьших привилегий уменьшает последствия компрометации.

Оставшиеся/новые риски
- Централизация источников секретов отсутствует (пока ручная ротация) — при компрометации процесса ротации инцидент может длиться дольше.
- Неправильная конфигурация CI/CD может раскрыть секреты в конвейере (артефакты, job logs).
- Скрипты развёртывания/миграций могут по привычке логировать env-переменные — риск утечки.

Рекомендации по смягчению
- CI/CD: запретить печать всех env-переменных в job logs; используйте masked secrets и audit для job-run.
- Pre-commit + CI: обеспечить, что gitleaks/semgrep конфигурации активны и тесты в CI фейлят сборку при обнаружении секретов.
- Логи: интегрировать фильтрацию секретов на уровне хэндлеров логирования; использовать структурированные логи и не включать raw env values.
- План ротации: документировать процесс ротации и проводить регулярные (например, ежегодные или при увольнении) ревью доступа.
- Путь к улучшению: создать roadmap по внедрению Vault/Secrets Manager (поэтапная миграция, сначала prod-среды).
